# Discord Bot -- Stock & Cryptocurrency Notifications

A bot based on Discord API and written in Python v3.9.2.
The bot is equipped with some basic commands, but is overall meant to provide notifications and information to a Discord user regarding stock and/or cryptocurrency information.

- Author: Aiden Zepp
- 'README.md' file updated as of: 8 March, 2021.

#

## Features

- Use various test commands to confirm bot is working.
- Stores the information of each user upon joining the server, along with commands to add a user to the system or view a user's information.
- Displays the information of the server.
- Fetches and stores cryptocurrency data from [CoinMarketCap](https://coinmarketcap.com/).
- Displays information about the top five ranked cryptocurrencies, ranked by [CoinMarketCap](https://coinmarketcap.com/).
- Displays information about one or multiple different cryptocurrencies, specified by the user.
- Adds information about one or multiple different cryptocurrencies, specified by the user, to the bot's stored information of the user.

#

## Tech

- [Discord API] - necessary for creating a Discord bot
- [CoinMarketCap API] - API responsible for cryptocurrency information
- [Visual Studio Code] - code editor used in creation of the bot's code. 

#

## Installation

This Discord bot requires [Python](https://www.python.org/) v3.9+ to run. Click [here](https://www.python.org/downloads/) to download the latest version of Python.

To install the Discord API, the instructions within the [Rapptz/discord.py Github](https://github.com/Rapptz/discord.py) 'README' file was used. 

For a quick installation on a Windows 10 device, open the Windows 10 'Command Prompt' and enter the following into the terminal:
```sh
py -3 -m pip install -U discord.py
```

--

In order to retrieve data and push out information via **CoinMarketCap**, the [Requests](https://pypi.org/project/requests/) Python library must be installed.

For a quick installation on a Windows 10 device, open the Windows 10 'Command Prompt' and enter the following into the terminal:
```sh
python -m pip install requests
```
> **Note:** the author of this code encountered an 'module not found' error (using 'Visual Studio Code'); the solution was to change the Python PATH used, found in the bottom left of VSCode.

--

The bot's code uses a `.gitignore` file to hide files containing unnecessary or sensitive information. To create and format the `.gitignore` file:
1. Inside the directory that's also storing the `.git` folder, `src` folder, and `README.md` file, create a new, blank text file and name it `.gitignore`.
2. Access the `.gitignore` file using the default Windows 10 application 'Notepad', or any other text editor application.
3. In the `.gitignore` file, type the directory path for each unnecessary or information-sensitive file. Make certain to type each file's directory path on a separate line. For example:
```sh
1   src/hidden
2   src/cogs/__psycache__
```

For the example above, `src/hidden` is a folder named `hidden` that is being stored in the `src` directory. For this source code, all files being hidden by `.gitignore` were stored in `src/hidden`, as long as they were able to be stored in `src/hidden`. The `secrets.json` file stored within the `hidden` folder is holding information for the API keys, used for both the Discord API and the CoinMarketCap API. Below shows the format used for the source `secrets.json` file.
```sh
1   {
2       "keys": {
3           "discord": "EXAMPLE_KEY",
4           "coinmarketcap": "EXAMPLE_KEY"
5       }
6   }
```
> **Note:** the keys for Discord and CoinMarketCap -- seen as `EXAMPLE_KEY` in the example above -- would be replaced with API keys generated by the individual intending to use this Discord bot.

#

## Generating API Keys
To generate an API key from either *Discord* or *CoinMarketCap*, follow the procedures below.

#### Discord:
1. Visit [discord.com](https://discord.com/) and log in or create a new account.
2. If you're redirected to Discord's web-browser version of the Discord app, go back to Discord's main site (link above).
3. Scroll down to the site's footer and click the *Developers* link found under the *Resources* section.
4. Upon the *Developers* site loading, click the *Applications* link in the top-left corner.
5. In the top-right corner, click the *New Application* button.
6. For further help understanding how to create and use a Discord bot, click [here](https://www.youtube.com/watch?v=nW8c7vT6Hl4) to be redirected to a video explaining the process.

#### CoinMarketCap:
1. Visit [coinmarketcap.com/api/](https://coinmarketcap.com/api/) and log in or create a new account.
2. In the *Dashboard* overview, look for the top-left *API Key* section.
3. Under this section, hover over the image of asterisks and click the button labeled *Copy Key*.

# 

## List of Commands:

Each command is either within the main `bot.py` file or within a cog file. The type of file for each section header is depicted by **[MAIN]** (representing commands within the main `bot.py` file) or **[COG]** (representing commands within its respective cog file).

#### [MAIN] Bot:
- `load`
    - **Aliases:** *n/a*
    - **Attributes:** *extension*
        - *extension*: the name of the cog trying to be loaded, without the file-type suffix; for example, trying to manually load the `test` cog (`test.py` file) would mean using `{Insert Prefix Here}load test`, as opposed to using `{Insert Prefix Here}load test.py`.
    - **Description:** loads a cog into the bot's program; doing so means a cog, along with all of the code it contains, can now be used by the bot.

- `unload`
    - **Aliases:** *n/a*
    - **Attributes:** *extension*
        - *extension*: the name of the cog trying to be unloaded, without the file-type suffix; for example, trying to manually unload the `test` cog (`test.py` file) would mean using `{Insert Prefix Here}unload test`, as opposed to using `{Insert Prefix Here}unload test.py`.
    - **Description:**: unloads a cog from the bot's program; doing so means a cog, along with all of the code it contains, can no longer be used by the bot.

- `reload`
    - **Aliases:** *n/a*
    - **Attributes:** *extension*
        - *extension*: the name of the cog trying to be reloaded, without the file-type suffix; for example, trying to manually reload the `test` cog (`test.py` file) would mean using `{Insert Prefix Here}reload test`, as opposed to using `{Insert Prefix Here}reload test.py`.
    - **Description:** reloads a cog from the bot's program; doing so means a cog, along with all of the code it contains, momentarilly cannot be used until the bot has finished loading the cog back in.

--

#### [COG] Test:
- `test`
    - **Aliases:** *n/a*
    - **Attributes:** *n/a*
    - **Description:** sends a message saying "*Command heard. Test successful.*" to the channel it was called in.

- `emoji_test`
    - **Aliases:** `emoji`
    - **Attributes:** *n/a*
    - **Description:** sends a message of the white check mark emoji (Emoji Syntax = :white_check_mark:) to the channel it was called in.

- `embed_test`
    - **Aliases:** `embed`
    - **Attributes:** *n/a*
    - **Description:** sends a message in the embed form to the channel it was called in, containing an example of each section that can be added to it (e.g. '.set_author', '.add_field'); includes an example of added fields with the 'inline' attribute being set to 'True' and fields set to 'False'.
        > **Note**: The bot's `embed_test` command does not have a `color / colour` attribute set within `discord.Embed()`. To add a color to the embed message, type a comma after the `description` attribute within `discord.Embed()` and set the `color / colour` attribute to the desired color. `color` and `colour` are the same, and are simply just aliases of each other. 
   
    - This command is used by the author generally as a quick reference guide of the various add-ons an embed message can have, and what arguments each one takes. Click [here](https://discordpy.readthedocs.io/en/latest/api.html#embed) to visit Discord's API Reference for an 'Embed'.

--

#### [COG] Information:
- `server`
    - **Aliases:** `serverinfo`, `s-info`, `guild`, `guild`, `guildinfo`
    - **Attributes:** *n/a*
    - **Description:** sends a message in the embed form to the channel it was called in, containing information about the Discord server the bot is in.
    - The information displayed is as follows:
        1. Name of Server
        2. Description of Server
        3. Owner
        4. ID of Server
        5. Region
        6. Member Count
        7. Icon of Server

- `add_user_info`
    - **Aliases:** `add-user-info`, `add-uinfo`, `adduser`
    - **Attributes:** *member (discord.Member)*
        - *member*: takes a [`discord.Member`](https://discordpy.readthedocs.io/en/latest/api.html#member) object as the attribute; simply @ the user -- as would normally be done when trying to tag a user in Discord -- along with the command (e.g. "{Insert Prefix Here}add_user_info @ExampleUser#0000").
    - **Description:** if, for whatever reason, a user's information hasn't been added to the **'src/hidden/ALL_USERS_INFO.json'** automatically, this command will take the information of the user @'d with the command and append their information to the list of users stored within **'ALL_USERS_INFO.json'**; the command sends a message in the embed form to the channel it was called in, containing all the same information that was stored in the above file.
    - The information stored and displayed is as follows:
        1. Display Name
        2. Discriminator
        3. ID
        4. Mention (the string used to mention the user)
        5. Nickname (the string form of the nickname a user has chosen for the server)
        6. Colour (a 'colour' object that has been stored in the file as a string)
        7. Joined At (a 'datetime' object that has been stored in the file as a string)

- `see_user_info`
    - **Aliases:** `see-user-info`, `see-uinfo`, `seeuser`
    - **Attributes:** *member (discord.Member)*
        - *member*: takes a `discord.Member` object as the attribute; simply @ the user along with the command (e.g. "{Insert Prefix Here}add_user_info @ExampleUser#0000").
    - **Description:** sends a message in the embed form to the channel it was called in, containing the information of the user @'d; if the user can't be found in the filepath **'src/hidden/ALL_USERS_INFO.json'**, the commands sends an error message in the embed form to the channel it was called in, stating that the user could not be found and to try using the `adduser` command to add the user to the system.
        > **Note:** Any stock or cryptocurrency information stored within the user's information is not displayed.

    - The information stored and displayed is as follows:
        1. Display Name
        2. Discriminator
        3. ID
        4. Mention (the string used to mention the user)
        5. Nickname (the string form of the nickname a user has chosen for the server)
        6. Colour (a 'colour' object that has been stored in the file as a string)
        7. Joined At (a 'datetime' object that has been stored in the file as a string)
    - For more information on the **discord.Member** object, click [here](https://discordpy.readthedocs.io/en/latest/api.html#member) to visit Discord’s API Reference for a ‘Member’.

--

#### [COG] Stocks:
- `force_load_cmc_data`
    - **Aliases:** `cmc-force`, `data-force`, `load-cmcdata`
    - **Attributes:** *n/a*
    - **Description:** manually does the process of loading the data from *CoinMarketCap* into the ***Stock*** class's `self.data`; sends a message in the embed form to the channel it was called in, stating that the data has been loaded.

- `crypto_top_5`
    - **Aliases:** `crypto-top5`, `crypto-5`, `c-top5`
    - **Attributes:** *n/a*
    - **Description:** sorts through the data obtained from *CoinMarketCap* to retrieve information of *CoinMarketCap's* top five cryptocurrencies; sends a message in the embed form to the channel it was called in, displaying information for each of the top five cryptocurrencies.
        - *CoinMarketCap* provides each cryptocurrency a ranking, and the rank of each cryptocurrency can be found within the data retrieved from *CoinMarketCap*.
    - The information displayed is as follows:
        1. Name
        2. Symbol
        3. Price (source code is set to USD; rounded to 2 decimal places)
        4. Last Updated
    
- `see_crypto_info`
    - **Aliases:** `see-crypto-info`, `see-cinfo`, `seecrypto`
    - **Attributes:** *crypto_symbols*
        - *crypto_symbols*: takes all of the characters passed after the command name and searches the cryptocurrency data for cryptocurrencies with matching symbols; sends a message in the embed form to the channel it was called in, displaying information for each cryptocurrency requested.
            > **Note:** the input symbols are **not** case-sensitive, though they will need to have only **one** space in between each currency; if any characters **not** in A-Z or a-z are part of the request, the symbol who has one of these characters will be returned with the error embed message.

    - **Description:** sorts through the data obtained from *CoinMarketCap* to retrieve information on cryptocurrencies with symbols matching any or all of the symbols requested; sends a message in the embed form to the channel it was called in, displaying information for each of the cryptocurrencies requested.
        - If any symbols are not found in the data, an error embed message will be sent stating which of the cryptocurrency symbols requested could not be found. If a symbol is requested for that is definitely a cryptocurrency's symbol, the `limit` set in the ***Stock*** class's `__init__()` may be set too low. For more information on this matter, visit the **FAQ** section within this *'README'* file.
    - The information displayed is as follows:
        1. Name
        2. Symbol
        3. ID
        4. Price (source code is set to USD; rounded to 2 decimal places)
        5. 24 Hour Volume (source code is set to USD)
        6. Date Added
        7. Rank on *CoinMarketCap*
        8. Number of Market Pairs
        9. Total Supply
        10. Circulating Supply
        11. Maximum Supply
        12. Last Updated

- `add_crypto_to_info`
    - **Aliases:** `add-crypto-self`, `add-cself`, `cryptoself`
    - **Attributes:** *crypto_symbols*
        - *crypto_symbols*: takes all of the characters passed after the command name and searches the data of cryptocurrencies for currencies with matching symbols; sends a message in the embed form to the channel it was called in, displaying information for each cryptocurrency requested.
            > **Note:** the input symbols are **not** case-sensitive, though they will need to have only **one** space in between each currency; if any characters **not** in A-Z or a-z are part of the request, the symbol who has one of these characters will be returned with the error embed message.

    - **Description:** sorts through the data obtained from *CoinMarketCap* to retrieve information on cryptocurrencies with symbols matching any or all of the symbols requested, and then adds those cryptocurrencies' information to the user's information in the `src/hidden/ALL_USERS_INFO.json` file; sends a message in the embed form to the channel it was called in, displaying a list of the cryptocurrencies requested and added to the user's information.
        - If any symbols are not found in the data, an error embed message will be sent stating which of the cryptocurrency symbols requested for that could not be found. If a symbol is requested for that is definitely a cryptocurrency's symbol, the `limit` set in the ***Stock*** class's `__init__()` may be set too low. For more information on this subject, visit the **FAQ** section within this *'README'* file.

#

## FAQ

##### ***Q: How do I set and/or use the Discord API key?***

If the name of the JSON file containing the API keys is a different name than `secrets.json`, be sure to change the filepath within the `# -- Load Discord API Key --` section; the code referenced can be found below.
```sh
# -- Load Discord API Key --
with open('src/hidden/secrets.json') as f: 
    secrets = json.load(f)
    api_keys = secrets['keys']
```

Within the parentheses of `open()` in the code above, enter the filepath being used to store the keys. In the code above taken from the source code, the filepath is `src/hidden/secrets.json`. For example, if only the file's name was changed and it was changed to `keys.json`, the code would look like the example code below.
```sh
# -- Load Discord API Key --
with open('src/hidden/keys.json') as f: 
    secrets = json.load(f)
    api_keys = secrets['keys']
```

Once the file storing the API keys has been created and the filepath is correct (instructions in the examples above), format the file as seen in **Installation** section of this *'README'* file or in the example code below.
```sh
1   {
2       "keys": {
3           "discord": "EXAMPLE_KEY",
4           "coinmarketcap": "EXAMPLE_KEY"
5       }
6   }
```
> **Note:** the keys for Discord and CoinMarketCap -- seen as `EXAMPLE_KEY` in the example above -- would be replaced with API keys generated by the individual intending to use this Discord bot.

--

##### ***Q: How do I change the command prefix?***

To change the command prefix, change the text in between the single quotations of the code below (found in the `bot.py` file, below the imports and above the **Events** section).
```sh
client = commands.Bot(command_prefix = '.')
```

If the command prefix needed to be `!`, the code below is an example of what the code would look like.
```sh
client = commands.Bot(command_prefix = '!')
```
> If the `bot.py` file uses the above example line of code, commands will only be able to get called using `!` as the prefix. For example, the `test` command would be called by a user by typing `!test`.

--

##### ***Q: How do I change the `limit` set for the CoinMarketCap data?***

The `limit` determines the number of cryptocurrencies stored in the cryptocurrencies' data file. The `limit` does not affect how much of the information within a stored cryptocurrency is retrieved.

Each cryptocurrency has a rank provided by *CoinMarketCap*. The `limit` sets the bot to retrieve information of the cryptocurrencies with ranks of 1 through the value assigned to `limit`.
> For example, if the `limit` is set to **'5000'**, the data would retrieve the information of the cryptocurrencies ranked from **1 to 5000**.

To change the `limit`, find and open the `stocks.py` file and locate the `__init__()` method. Within `__init__()`, a comment can be found stating:
> CoinMarketCap API Documentation - Quickstart Guide's Format

In this section of code, find `parameters`. Within `parameters`, locate `limit` and change the value assigned to it. The code below is an example of what the code would look like.
```sh
        # CoinMarketCap API Documentation - Quickstart Guide's Format
        url = 'https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest'

        parameters = {
            'start': '1',
            'limit': '100',
            'convert': 'USD'
        }
```
> If the `stocks.py` file uses the above example code, the amount of data retrieved from CoinMarketCap would be limited to the cryptocurrencies from ranks 1-100.

--

##### ***Q: How do I change the currency that the cryptocurrencies are converted to?***

The `convert` determines the 'real-world' currency that the cryptocurrencies are converted to. This becomes relevant when accessing certain details, such as the `price`, of a cryptocurrency's information within the data.

*CoinMarketCap* base-level accounts that are using API keys are only able to convert a single real-world currency at a time. An upgraded *CoinMarketCap* account would be needed in order to use `convert` with more than one real-world currency.

To change the `convert`, find and open the `stocks.py` file and locate the `__init__()` method. Within `__init__()`, a comment can be found stating:
> CoinMarketCap API Documentation - Quickstart Guide's Format

In this section of code, find `parameters`. Within `parameters`, locate `convert` and change the value assigned to it with a real-world currency code (e.g. USD, EUR, CNY). The code below is an example of what the code would look like.
```sh
        # CoinMarketCap API Documentation - Quickstart Guide's Format
        url = 'https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest'

        parameters = {
            'start': '1',
            'limit': '100',
            'convert': 'USD'
        }
```
> If the `stocks.py` file uses the above example code, each cryptocurrency would contain information relating to the conversion to USD.

#

## Development

Want to contribute opinions, ideas, or other related items about this Discord bot? 

Please contact the author via email:
> <aiden.zepp@gmail.com>

#

## License

This software is free to use. The author is not responsible for any implementations of the source code upon the code being altered.

   [Discord API]: <https://discord.com/developers/docs/intro>
   [CoinMarketCap API]: <https://coinmarketcap.com/api/documentation/v1/#>
   [Visual Studio Code]: <https://code.visualstudio.com/>

